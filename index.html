<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background: #f0f2f5; }
        .container { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); width: 80%; text-align: center; }
        .grid { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin: 20px 0; }
        .card { width: 60px; height: 90px; background: #2c3e50; color: white; display: flex; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; font-size: 24px; border: 3px solid transparent; }
        .card.selected { background: #3498db; border-color: #2980b9; }
        #confirm-btn { width: 100%; padding: 15px; background: #ccc; color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; }
        #confirm-btn.active { background: #27ae60; }
    </style>
</head>
<body>
    <div class="container">
        <h3>Выберите 3 карты</h3>
        <div class="grid" id="grid"></div>
        <button id="confirm-btn" disabled>Подтвердить выбор</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        const cardNames = ["Маг", "Жрица", "Императрица", "Император", "Жрец"];
        let selected = [];
        const grid = document.getElementById('grid');
        const btn = document.getElementById('confirm-btn');

        cardNames.forEach(name => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerText = '?';
            card.onclick = () => {
                if (selected.includes(name)) {
                    selected = selected.filter(n => n !== name);
                    card.classList.remove('selected');
                } else if (selected.length < 3) {
                    selected.push(name);
                    card.classList.add('selected');
                }
                btn.disabled = selected.length !== 3;
                btn.classList.toggle('active', selected.length === 3);
            };
            grid.appendChild(card);
        });

        btn.onclick = async () => {
            const userId = tg.initDataUnsafe?.user?.id || "no_id";
            const cards = selected.join(", ");
            // ВСТАВЬ СЮДА СВОЮ ССЫЛКУ ИЗ ЛОГА ДО СЛОВА /exec
            const scriptURL = "https://script.google.com/macros/s/AKfycbxhA-rBX7mIXP0mrCJD3HPnM670GCYLCIw5r_rwzESfQmmIp_vS6SiplTZBipil8OKmtA/exec";
            
            btn.innerText = "Сохранение...";
            try {
                await fetch(`${scriptURL}?user_id=${userId}&cards=${encodeURIComponent(cards)}`, { mode: 'no-cors' });
                tg.close();
            } catch (e) {
                btn.innerText = "Ошибка";
            }
        };
    </script>
</body>
</html>
