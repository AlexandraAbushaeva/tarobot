<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #f0f2f5; }
        .grid { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin: 20px 0; }
        .card { width: 65px; height: 95px; background: #2c3e50; color: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 3px solid transparent; font-size: 11px; }
        .card.selected { background: #3498db; border-color: #2980b9; }
        #btn { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 12px; font-weight: bold; display: none; }
        #log { font-size: 10px; color: red; margin-top: 20px; }
    </style>
</head>
<body>
    <h3>Выбери 3 карты</h3>
    <div class="grid" id="grid"></div>
    <button id="btn">ПОДТВЕРДИТЬ</button>
    <div id="log"></div>

    <script>
        try {
            const tg = window.Telegram.WebApp;
            tg.expand();
            const names = ["Маг", "Жрица", "Императрица", "Император", "Жрец"];
            let sel = [];
            const grid = document.getElementById('grid');
            const btn = document.getElementById('btn');

            names.forEach(n => {
                const c = document.createElement('div');
                c.className = 'card'; c.innerText = n;
                c.onclick = () => {
                    if (sel.includes(n)) { sel = sel.filter(i => i !== n); c.classList.remove('selected'); }
                    else if (sel.length < 3) { sel.push(n); c.classList.add('selected'); }
                    btn.style.display = sel.length === 3 ? "block" : "none";
                };
                grid.appendChild(c);
            });

            btn.onclick = async () => {
                const uid = tg.initDataUnsafe?.user?.id || "test";
                const cards = sel.join(", ");
                // ВСТАВЬ СВОЮ ССЫЛКУ НИЖЕ, НЕ УДАЛЯЯ КАВЫЧКИ
                const scriptURL = "https://script.google.com/macros/s/AKfycbw98v0ljrOEGZU57RXHCvspl3NkpxMZYNzVKA1kvYFo34FUR3JpzyND8GnVet8p1GzSAg/exec"; 
                
                const finalURL = `${scriptURL}?user_id=${uid}&cards=${encodeURIComponent(cards)}&action=save`;
                
                btn.innerText = "СОХРАНЯЕМ...";
                await fetch(finalURL, { mode: 'no-cors' });
                tg.close();
            };
        } catch (e) {
            document.getElementById('log').innerText = "Ошибка кода: " + e.message;
        }
    </script>
</body>
</html>
