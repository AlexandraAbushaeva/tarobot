<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background: #f4f4f9; }
        .grid { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin: 20px; }
        .card { width: 70px; height: 100px; background: #2c3e50; color: white; display: flex; align-items: center; justify-content: center; border-radius: 10px; cursor: pointer; font-size: 11px; text-align: center; padding: 5px; border: 3px solid transparent; }
        .card.selected { background: #3498db; border-color: #2980b9; transform: scale(1.05); }
        #btn { width: 200px; padding: 15px; background: #ccc; border: none; border-radius: 12px; color: white; font-weight: bold; }
        #btn.active { background: #27ae60; cursor: pointer; }
    </style>
</head>
<body>
    <h3>Выберите 3 карты</h3>
    <div class="grid" id="grid"></div>
    <button id="btn" disabled>ПОДТВЕРДИТЬ</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        const names = ["Маг", "Жрица", "Императрица", "Император", "Жрец"];
        let sel = [];
        const grid = document.getElementById('grid');
        const btn = document.getElementById('btn');

        names.forEach(n => {
            const c = document.createElement('div');
            c.className = 'card'; c.innerText = n;
            c.onclick = () => {
                if (sel.includes(n)) { sel = sel.filter(i => i !== n); c.classList.remove('selected'); }
                else if (sel.length < 3) { sel.push(n); c.classList.add('selected'); }
                btn.disabled = sel.length !== 3; btn.classList.toggle('active', sel.length === 3);
            };
            grid.appendChild(c);
        });

        btn.onclick = async () => {
            const uid = tg.initDataUnsafe?.user?.id || "no_id";
            const cards = sel.join(", ");
            const scriptURL = "https://script.google.com/macros/s/AKfycbzWuguXMpDYPngXwmMCtP_gVz8S7VJ4HkoPfD4Xo79gOPHUxs2C6WiRFJZTupi4zwh-eA/exec"; 
            
            btn.innerText = "ОТПРАВКА...";
            try {
                // Магия: отправляем данные в скрипт, а он сам всё сделает
                await fetch(`${scriptURL}?user_id=${uid}&cards=${encodeURIComponent(cards)}`, { mode: 'no-cors' });
                tg.close();
            } catch (e) {
                btn.innerText = "ОШИБКА";
            }
        };
    </script>
</body>
</html>
